<ion-header>
  <ion-toolbar>
    <ion-title>Реєстрація автопарку</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <park-card [parking]="parking()" [editMode]="false" [uploadedLogoUrl]="uploadedLogoUrl"></park-card>

  <form>
    <div class="form-input" #nameRef [appValidateInput]="nameRef">
      <div class="input-row">
        <ion-label position="static" [class.focused]="isFocused['name']">

          @if (!isFocused['name'] || name.valid) {
            <span>Назва</span>
          }

          @if (name.valid) {
            <ion-icon name="checkmark-circle-outline" class="checkmark-icon"></ion-icon>
          }

          @if (isFocused['name'] && !name.valid) {
            <ion-spinner name="dots" color="primary"></ion-spinner>
          }

        </ion-label>

        <ion-input
          type="text"
          class="aligned-input"
          placeholder="Введіть назву автопарку"
          [formControl]="name"
          (ionFocus)="onFocus('name')"
          (ionBlur)="onBlur('name')"
        ></ion-input>
      </div>

      <div [appValidateInput]="nameRef" [control]="name" class="error-container">
        <!-- Контейнер для помилки -->
      </div>
    </div>


    <div class="form-input relative" #addressRef [appValidateInput]="addressRef">
      <div class="input-row">
        <ion-label position="static" [class.focused]="isFocused['address']">

          @if (!isFocused['address'] || address.valid) {
            <span>Адреса</span>
          }

          @if (address.value) {
            <ion-icon name="checkmark-circle-outline" class="checkmark-icon"></ion-icon>
          }

        </ion-label>

        <ion-input #addressInput
          type="text"
          class="aligned-input"
          placeholder="Додайте адресу автопарку"
          [formControl]="address"
          (ionInput)="fetchSuggestions($event.target.value)"
          (ionFocus)="fetchSuggestions(address.value)"
          (ionBlur)="onBlur('address')"
        ></ion-input>
      </div>

      <div [appValidateInput]="addressRef" [control]="address" class="error-container">
        <!-- Контейнер для помилки -->
      </div>

      @if (address.value) {
        <google-places
        [suggestions]="suggestions()"
        [selectSuggestion]="selectSuggestion.bind(this)"
        [control]="address"
        >
        </google-places>
      }
    </div>

    <div class="flex items-center">
      <div class="form-input relative min-w-[86%]" #addressRef [appValidateInput]="addressRef"
           [class.!min-w-[100%]]="!uploadedLogoUrl"
      >
        <div class="input-row">
          <ion-button id="popover-trigger" class="absolute left-[35px] bottom-[-3px] z-50">
            <ion-icon name="images-outline" class="text-black"></ion-icon>
            <ion-icon name="help-circle-outline" class="text-[17px] pb-[25px] text-black"></ion-icon>
          </ion-button>

          <input #fileInput type="file" accept="image/*" (change)="handleFileUpload($event)"
                 class="opacity-0 absolute left-0 right-0 top-0 bottom-0 w-full"
          >
          <ion-text class="flex items-center gap-2 font-[300] justify-center w-full py-1">
            Додати логотип
            @if (logoUploading()) {
              <span class="font-bold">{{ uploadProgress() }} %</span>
            } @else {
              <img src="assets/icon/upload.svg" class="h-5 w-5">
            }
          </ion-text>
        </div>
      </div>

      @if (uploadedLogoUrl) {
        <ion-button fill="clear" class="text-xs w-full mb-2.5" (click)="clearSelectedLogo()">
          <div class="flex flex-col items-center border rounded py-2 px-3 border-red-300">
            <img src="assets/icon/svg/delete.svg" class="h-[25px]">
          </div>
        </ion-button>
      }
    </div>


    <main-action-btn [title]="'Створити'" [styles]="'py-3'"></main-action-btn>
  </form>
</ion-content>

<ion-popover trigger="popover-trigger">
  <ng-template>
    <div class="flex flex-col text-xs p-4 bg-black rounded-md text-white">
      <h3 class=" font-semibold mb-2">Підтримуючі формати:</h3>
      <div class="flex flex-col space-y-1">
        <ng-container *ngFor="let format of formats">
          <span class="flex items-center text-shadow">
            <ion-icon name="checkmark-outline" class="mr-1 text-green-400"></ion-icon>
            {{ format }}
          </span>
        </ng-container>
      </div>
    </div>
  </ng-template>
</ion-popover>

